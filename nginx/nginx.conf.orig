worker_processes 1;

events { worker_connections 1024; }

http {
    server {
        listen 80;
        listen [::]:80;
        listen 443 ssl;
        listen [::]:443;
        listen 8280 ssl;
        listen [::]:8280;

<<<<<<< HEAD
        server_name konfettiapp.de www.konfettiapp.de test.konfettiapp.de ssl;
=======
        server_name localhost konfettiapp.de www.konfettiapp.de test.konfettiapp.de ssl;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
#        ssl_certificate /etc/letsencrypt/live/konfettiapp.de/fullchain.pem;
#        ssl_certificate_key /etc/letsencrypt/live/konfettiapp.de/privkey.pem;

        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;
        ssl_ciphers 'EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH';

<<<<<<< HEAD
        location /admin/ {
#            proxy_redirect http:// https://;
            rewrite ^/admin/(.*)$ /$1 break;
            proxy_pass http://konfettiAdmin:80/;
=======
        location ^~ /admin {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiAdmin:8080;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_cache_bypass $http_upgrade;
        }
<<<<<<< HEAD
        location /coupongenerator/ {
#            proxy_redirect http:// https://;
            rewrite ^/coupongenerator/(.*)$ /$1 break;
            proxy_pass http://konfettiCouponGenerator:2342/;
=======
        location ~* /coupongenerator {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiCouponGenerator:2342;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_cache_bypass $http_upgrade;
        }
<<<<<<< HEAD
        location /bootadmin/ {
#            proxy_redirect http:// https://;
            rewrite ^/bootadmin/(.*)$ /$1 break;
            proxy_pass http://konfettiBootAdmin:8180/;
=======
        location ~* /bootadmin {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiBootAdmin:8180;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_cache_bypass $http_upgrade;
        }
<<<<<<< HEAD
        location /konfetti/api/ {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiApi:8280/konfetti/api/;
=======
        location ~* /konfetti/api {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiApi:8280;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_cache_bypass $http_upgrade;
        }
<<<<<<< HEAD
        location / {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiApp:80/;
=======
        location ~* / {
#            proxy_redirect http:// https://;
            proxy_pass http://konfettiApp:80;
>>>>>>> add nginx as konfettiLoadbalancer (not configured yet)
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_cache_bypass $http_upgrade;
        }
    }
#    server {
#        listen 80;
#        listen [::]:80;
#        return 301 https://$host$request_uri;
#    }
}
